<div class="container mat-elevation-z8">

  <form class="form">

    <h1 *ngIf="!isCompanyLinkedCreation" class="fullWidth">{{ personId ? 'Editar Colaborador: ' + person.name : 'Cadastrar Colaborador' }}</h1>
    <h1 *ngIf="isCompanyLinkedCreation" class="fullWidth">{{ personId ? 'Editar Colaborador: ' + person.name : 'Cadastrar Colaborador na Unidade ' + company?.value?.name }}</h1>
    <img class="fullWidth" src="assets/img/tecnico-create.svg" alt="Cadastrar Colaborador">

    <section class="section">
      <mat-checkbox (click)="addPersonType(1)" [disabled]="true" class="margin" [checked]="true" color="primary">Colaborador</mat-checkbox>
    </section>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Nome</mat-label>
      <input
        [(ngModel)]="person.name"
        name="name"
        [formControl]="name"
        required
        matInput
        placeholder="Ex. Maria da Silva"
        maxlength="100" >
      <mat-icon matSuffix>sentiment_very_satisfied</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>CPF</mat-label>
      <input
      [(ngModel)]="person.cpf"
      name="cpf"
      [formControl]="cpf"
      required
      matInput
      placeholder="Ex..000.000.000-00"
      mask="000.000.000-00">
      <mat-icon matSuffix>pin </mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="outline" *ngIf="!isCompanyLinkedCreation">
      <mat-label>Selecione a Unidade</mat-label>
      <mat-select
        [(ngModel)]="personCompany"
        (ngModelChange)="selectCompany()"
        name="company"
        [formControl]="company">
        <mat-option *ngFor="let company of companies" [value]="company">{{ company.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="outline">
      <mat-label>{{departments.length > 0 ? 'Selecione o Departamento' : 'Não há Departamentos para a unidade selecionada'}}</mat-label>
      <mat-select
        [(ngModel)]="person.departmentId"
        name="department"
        [formControl]="department"
        [disabled]="!companyId">
        <mat-option *ngFor="let department of departments" [value]="department.id">{{ department.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="outline">
      <mat-label>Selecione a Responsabilidade</mat-label>
      <mat-select
        [(ngModel)]="person.responsibilityId"
        name="responsibility"
        [formControl]="responsibility">
        <mat-option *ngFor="let responsibility of responsibilities" [value]="responsibility.id">{{ responsibility.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Nome de Usuário</mat-label>
      <input
      [(ngModel)]="person.user.username"
      name="username"
      [formControl]="username"
      required
      matInput
      placeholder="Ex.. fulano44">
      <mat-icon matSuffix>person</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>E-mail</mat-label>
      <input
      [(ngModel)]="person.user.email"
      name="email"
      [formControl]="email"
      required
      matInput
      placeholder="Ex.. fulano@mail.com">
      <mat-icon matSuffix>email</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Senha</mat-label>
      <input
      [(ngModel)]="person.user.password"
      name="password"
      [formControl]="password"
      required
      type="password"
      matInput
      placeholder="Ex.. 1234">
      <mat-icon matSuffix>password</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="outline">
      <mat-label>Selecione o cargo</mat-label>
      <mat-select
        [(ngModel)]="person.user.roles"
        name="role"
        [formControl]="role"
        required
        multiple>
        <mat-option *ngFor="let role of roleLabels" [value]="role.value.name">{{ role.label }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>CEP</mat-label>
      <input
      [(ngModel)]="person.address.cep"
      name="cep"
      [formControl]="cep"
      required
      type="cep"
      matInput
      placeholder="Ex.. 12.444-666">
      <mat-icon matSuffix>location_on</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Bairro</mat-label>
      <input
      [(ngModel)]="person.address.neighborhood"
      name="neighborhood"
      [formControl]="neighborhood"
      required
      type="neighborhood"
      matInput
      placeholder="Ex.. vila das neves">
      <mat-icon matSuffix>signpost</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Rua</mat-label>
      <input
      [(ngModel)]="person.address.streetName"
      name="streetName"
      [formControl]="streetName"
      required
      type="streetName"
      matInput
      placeholder="Ex.. rua das neves">
      <mat-icon matSuffix>add_road</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Cidade</mat-label>
      <input
      [(ngModel)]="person.address.city"
      name="city"
      [formControl]="city"
      required
      type="city"
      matInput
      placeholder="Ex.. Pontalina">
      <mat-icon matSuffix>location_city</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Estado</mat-label>
      <input
      [(ngModel)]="person.address.uf"
      name="uf"
      [formControl]="uf"
      required
      type="uf"
      matInput
      placeholder="Ex.. Pontalina">
      <mat-icon matSuffix>satellite</mat-icon>
    </mat-form-field>

    <mat-form-field class="fullWidth" appearance="legacy">
      <mat-label>Complemento</mat-label>
      <input
      [(ngModel)]="person.address.complement"
      name="complement"
      [formControl]="complement"
      required
      type="complement"
      matInput
      placeholder="Ex.. Pontalina">
      <mat-icon matSuffix>edit_location_alt</mat-icon>
    </mat-form-field>

    <div class="container mat-elevation-z8" *ngIf="personId">
      <div class="table-header">
        <span>Rotinas</span>

        <button routerLink="/person/{{ personId }}/routine/create" class="mat-elevation-z4" id="linkRoutineToPerson" mat-flat-button color="primary">
          Vincular rotina ao colaborador
        </button>
      </div>

      <table mat-table [dataSource]="routineDataSource" matSort matSortActive="name" matSortDisableClear matSortDirection="desc" *ngIf="routineDataSource.data.length; else noData">
  
        <ng-container matColumnDef="routineName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Nome</th>
          <td mat-cell *matCellDef="let element">{{element.name}}</td>
        </ng-container>
  
        <ng-container matColumnDef="routineActions">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let element">
            <div class="mat-cell-wrapper">
              <a routerLink="../routine/edit/{{ element.id }}">
                <i class="material-icons edit">edit</i>
              </a>
            </div>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="routineDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: routineDisplayedColumns;"></tr>
      </table>

      <ng-template #noData>
        <div>
          <span>Ainda não há rotinas vinculadas a este colaborador</span>
        </div>
      </ng-template>
  
      <mat-paginator #routinePaginator [pageSizeOptions]="[5, 10, 20, 50, 100]" showFirstLastButtons *ngIf="personRoutines.length"></mat-paginator>
    </div>

    <div class="container mat-elevation-z8" *ngIf="personId">
      <div class="table-header">
        <span>Tarefas</span>

        <button routerLink="/person/{{ personId }}/task/create" class="mat-elevation-z4" id="linkTaskToPerson" mat-flat-button color="primary">
          Vincular tarefa ao colaborador
        </button>
      </div>

      <table mat-table [dataSource]="taskDataSource" matSort matSortActive="name" matSortDisableClear matSortDirection="desc" *ngIf="taskDataSource.data.length; else noData">
  
        <ng-container matColumnDef="taskName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Nome</th>
          <td mat-cell *matCellDef="let element">{{element.name}}</td>
        </ng-container>
  
        <ng-container matColumnDef="taskActions">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let element">
            <div class="mat-cell-wrapper">
              <a routerLink="../task/edit/{{ element.id }}">
                <i class="material-icons edit">edit</i>
              </a>
            </div>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="taskDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: taskDisplayedColumns;"></tr>
      </table>

      <ng-template #noData>
        <div>
          <span>Ainda não há tarefas vinculadas a este colaborador</span>
        </div>
      </ng-template>
  
      <mat-paginator #taskPaginator [pageSizeOptions]="[5, 10, 20, 50, 100]" showFirstLastButtons *ngIf="personTasks.length"></mat-paginator>
    </div>

    <div class="container mat-elevation-z8" *ngIf="personId">
      <div class="table-header">
        <span>Atribuições</span>

        <button routerLink="/person/{{ personId }}/assignment/create" class="mat-elevation-z4" id="linkAssignmentToPerson" mat-flat-button color="primary">
          Vincular atribuição ao colaborador
        </button>
      </div>

      <table mat-table [dataSource]="assignmentDataSource" matSort matSortActive="name" matSortDisableClear matSortDirection="desc" *ngIf="assignmentDataSource.data.length; else noData">
  
        <ng-container matColumnDef="assignmentName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Nome</th>
          <td mat-cell *matCellDef="let element">{{element.name}}</td>
        </ng-container>
  
        <ng-container matColumnDef="assignmentActions">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let element">
            <div class="mat-cell-wrapper">
              <a routerLink="../assignment/edit/{{ element.id }}">
                <i class="material-icons edit">edit</i>
              </a>
            </div>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="assignmentDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: assignmentDisplayedColumns;"></tr>
      </table>

      <ng-template #noData>
        <div>
          <span>Ainda não há atribuições vinculadas a este colaborador</span>
        </div>
      </ng-template>
  
      <mat-paginator #assignmentPaginator [pageSizeOptions]="[5, 10, 20, 50, 100]" showFirstLastButtons *ngIf="personAssignments.length"></mat-paginator>
    </div>

    <button (click)="openPersonForm()" [disabled]="!validateFields()" class="fullWidth mat-elevation-z4" mat-flat-button color="primary">
      {{ personId ? 'Salvar' : 'Cadastrar' }}
    </button>
    <button routerLink="../" class="fullWidth mat-elevation-z4" mat-stroked-button color="warn">Cancelar</button>
  </form>

</div>
